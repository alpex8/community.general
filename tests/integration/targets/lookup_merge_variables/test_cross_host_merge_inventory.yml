---
# Copyright (c) 2020, Thales Netherlands
# Copyright (c) 2021, Ansible Project
# GNU General Public License v3.0+ (see LICENSES/GPL-3.0-or-later.txt or https://www.gnu.org/licenses/gpl-3.0.txt)
# SPDX-License-Identifier: GPL-3.0-or-later

common:
  vars:
    provider_instances:
      servicedata1:
        host: "{{ hostvars[groups['provider'] | first].inventory_hostname }}"
        user: usr
        pass: pwd
      servicedata2:
        host: down
        user: usr2
        pass: pwd2
  hosts:
    host1:
    host2:

consumer:
  vars:
    service_data: "{{ provider_instances.servicedata1 }}"
    merge2__1: "{{ service_data }}"  # fails for host1; would work if using provider_instances directly here, as it is a variable host1 owns
  hosts:
    host2:

provider:
  vars:
    merge1: "{{ lookup('community.general.merge_variables', 'merge2__', pattern_type='prefix', groups=['consumer']) }}"
  hosts:
    host1:
